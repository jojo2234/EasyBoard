!function(){function a(a){this.config=f(i,a),this._initContainer(),this._initCanvas(),b.apply(this,[this.config,this.ctx,0,0,this.canvas.width,this.canvas.height]),this._initHuePicker(),this._initColorSquare(),this._attachMouseListeners(),this._attachPickerListeners()}function b(a,b,c,d,e,f){this.config=a,this.ctx=b,c=null==c||isNaN(c)?0:c,d=null==d||isNaN(c)?0:d,this.width=e,this.height=f,this.containsPoint=function(a,b){return a>=this.x&&a<this.x+this.width&&b>=this.y&&b<this.y+this.height},this.getCanvasColorAtPoint=function(a,b){var c=this.ctx.getImageData(a,b,1,1),d=c.data,e=[d[0],d[1],d[2]],f=g.apply(this,e);return{rgb:e,hsl:f}},this.drawArea=function(a,b,c,d){var e,f,g,h,i=isNaN(a)?0:a,j=isNaN(b)?0:b,k=isNaN(c)?this.width:c,l=isNaN(d)?this.height:d,m=this.ctx.getImageData(i,j,k,l),n=m.data;for(e=i;i+k>e;e++)for(f=j;j+l>f;f++)h=4*((f-j)*k+(e-i)),0>h||h>n.length-4||(this.containsPoint(e,f)!==!0?n[h+3]=0:(g=this.rgbAtPoint(e,f),n[h]=g[0],n[h+1]=g[1],n[h+2]=g[2],n[h+3]=255));this.ctx.putImageData(m,i,j)},this.setPosition=function(a,b){this.x=Math.round(a),this.y=Math.round(b),this.centerX=this.x+Math.round(this.width/2),this.centerY=this.y+Math.round(this.height/2)},this.setPosition(c,d)}function c(){b.apply(this,arguments),this.outerRadius=this.width/2,this.innerRadius=this.outerRadius-this.width/10,this.outerR2=Math.pow(this.outerRadius,2),this.innerR2=Math.pow(this.innerRadius,2),this._initMarker(),this.containsPoint=function(a,b){var c=Math.pow(a-this.centerX,2)+Math.pow(b-this.centerY,2);return c>=this.innerR2&&c<=this.outerR2}}function d(){b.apply(this,arguments),this.hue=isNaN(this.config.initialHue)?0:this.config.initialHue%360,this.marker=new e(this.config,this.ctx,this.x+this.width/2,this.y+this.height/2),this.updateMarker=c.prototype.updateMarker}function e(){var a=Array.prototype.slice.call(arguments);this.config=arguments[0];var c=this.config.markerWidth;a[4]=null==a[4]?c:a[4],a[5]=null==a[5]?c:a[5],b.apply(this,a),this.lineWidth=1}function f(){for(var a={},b=0;b<arguments.length;b++){var c=JSON.parse(JSON.stringify(arguments[b]));for(var d in c)a[d]=c[d]}return a}function g(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;e=h>.5?i/(2-f-g):i/(f+g),f==a?d=(b-c)/i+(c>b?6:0):f==b?d=(c-a)/i+2:f==c&&(d=(a-b)/i+4),d/=6}return[Math.round(360*d),Math.round(100*e),Math.round(100*h)]}function h(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var e,f,g,h,i;return a/=360,b/=100,c/=100,0===b?e=f=g=c:(i=.5>c?c*(1+b):c+b-c*b,h=2*c-i,e=d(h,i,a+1/3),f=d(h,i,a),g=d(h,i,a-1/3)),[Math.round(255*e),Math.round(255*f),Math.round(255*g)]}var i={size:300,markerWidth:10,initialHue:-140};a.COLOR_PICKED="colorPicked",a.prototype.draw=function(){this.huePicker.draw(),this.colorSquare.draw()},a.prototype.getColor=function(){var a=this.colorSquare.marker,b=this.getCanvasColorAtPoint(a.x,a.y);return b},a.prototype.getRGB=function(){return this.getColor().rgb},a.prototype.getHSL=function(){return this.getColor().hsl},a.prototype.setRGB=function(a,b,c){this.huePicker.setRGB(a,b,c),this.colorSquare.setRGB(a,b,c)},a.prototype.setHSL=function(a,b,c){this.huePicker.setHSL(a,b,c),this.colorSquare.setHSL(a,b,c)},a.prototype.getCanvasPositionForEvent=function(a){var b=a.clientX-this.canvas.offsetLeft+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY-this.canvas.offsetTop+document.body.scrollTop+document.documentElement.scrollTop;return{top:c,left:b}},a.prototype._initContainer=function(){this.el=document.getElementById(this.config.id),null==this.el&&(this.el=document.createElement("div"),document.body.appendChild(this.el))},a.prototype._initCanvas=function(){"canvas"==this.el.tagName.toLowerCase()?this.canvas=this.el:(this.canvas=document.createElement("canvas"),this.el.appendChild(this.canvas)),this.canvas.setAttribute("width",this.config.size),this.canvas.setAttribute("height",this.config.size),this.ctx=this.canvas.getContext("2d")},a.prototype._initHuePicker=function(){this.huePicker=new c(this.config,this.ctx,0,0,this.canvas.width,this.canvas.height)},a.prototype._initColorSquare=function(){var a=this.canvas.width/2,b=this.centerX-a/2;this.colorSquare=new d(this.config,this.ctx,b,b,a,a)},a.prototype._attachMouseListeners=function(){function a(a,e){for(var f=0;f<b.interactables.length;f++){var g=b.interactables[f];if(g.containsPoint(a,e))return d===!0&&null==c&&(c=g),!0}return!1}var b=this,c=null,d=!1;this.interactables=[this.huePicker,this.colorSquare],this.canvas.addEventListener("mousedown",function(a){d=!0,b._onInteraction(a,c)},!1),this.canvas.addEventListener("mousemove",function(e){var f=b.getCanvasPositionForEvent(e),g=f.left,h=f.top,i=a(g,h);b._toggleCursor(i),d===!0&&b._onInteraction(e,c)},!1),this.canvas.addEventListener("mouseup",function(){d=!1,c=null},!1)},a.prototype._attachPickerListeners=function(){var b=this;this.canvas.addEventListener(c.HUE_PICKED,function(a){var c=a.detail;null!=c&&null!=c.hsl&&b.colorSquare.draw(c.hsl[0])},!1),this.canvas.addEventListener(d.SQUARE_PICKED,function(c){var d=new CustomEvent(a.COLOR_PICKED,{detail:c.detail});b.canvas.dispatchEvent(d)},!1)},a.prototype._onInteraction=function(a,b){for(var c=this.getCanvasPositionForEvent(a),d=c.left,e=c.top,f=null==b?this.interactables:[b],g=0;g<f.length;g++){var h=f[g];if(h.containsPoint(d,e))return void h.pickPoint(d,e)}},a.prototype._toggleCursor=function(a){var b=a===!0?"crosshair":"default";this.canvas.style.cursor=b},window.CanvasColorPicker=a,c.HUE_PICKED="huePicked",c.prototype._initMarker=function(){var a=this.innerRadius+(this.outerRadius-this.innerRadius)/2,b=this.centerX,c=this.centerY,d=this.config.initialHue;null==d||isNaN(d)?d=0:d*=Math.PI/180,b+=a*Math.cos(d),c+=a*Math.sin(d),this.marker=new e(this.config,this.ctx,b,c)},c.prototype.draw=function(){this.drawArea(this.x,this.y,this.width,this.height),this.marker.draw()},c.prototype.rgbAtPoint=function(a,b){var c=180*Math.atan2(b-this.centerY,a-this.centerX)/Math.PI;return c=c.toFixed(2),h(c,100,50)},c.prototype.updateMarker=function(a,b){var c=4,d=this.marker.getTopLeft(),e=d.left-c,f=d.top-c;this.drawArea(e,f,this.marker.width+2*c,this.marker.height+2*c),this.marker.setPosition(a,b),this.marker.draw()},c.prototype.pickPoint=function(a,b,d){if(a=Math.round(a),b=Math.round(b),this.updateMarker(a,b),d!==!0){var e={detail:this.getCanvasColorAtPoint(a,b)},f=new CustomEvent(c.HUE_PICKED,e);this.ctx.canvas.dispatchEvent(f)}},c.prototype.setRGB=function(a,b,c){var d=g(a,b,c);this.setHSL.apply(this,d)},c.prototype.setHSL=function(a){var b=a*Math.PI/180,c=this.innerRadius+(this.outerRadius-this.innerRadius)/2,d=c*Math.cos(b)+this.centerX,e=c*Math.sin(b)+this.centerY;this.pickPoint(d,e,!0)},d.SQUARE_PICKED="squarePicked",d.prototype.draw=function(a,b){this.hue=null==a?this.hue:a,this.drawArea(this.x,this.y,this.width,this.height),this.marker.draw(),b!==!0&&this.pickMarkerColor()},d.prototype.rgbAtPoint=function(a,b){var c=(a-this.x)/this.width*100,d=100-(b-this.y)/this.height*100;return h(this.hue,c,d)},d.prototype.pickPoint=function(a,b,c){a=Math.round(a),b=Math.round(b),this.updateMarker(a,b),c!==!0&&this.pickMarkerColor()},d.prototype.pickMarkerColor=function(){var a=this.getCanvasColorAtPoint(this.marker.x,this.marker.y),b={detail:a},c=new CustomEvent(d.SQUARE_PICKED,b);this.ctx.canvas.dispatchEvent(c)},d.prototype.setRGB=function(a,b,c){var d=g(a,b,c);this.setHSL.apply(this,d)},d.prototype.setHSL=function(a,b,c){var d=b/100*this.width+this.x,e=(100-c)/100*this.height+this.y;this.draw(a,!0),this.pickPoint(d,e)},e.prototype.draw=function(){var a=this.width/2;this.ctx.beginPath(),this.ctx.arc(this.x,this.y,a,0,2*Math.PI),this.ctx.strokeStyle="white",this.ctx.lineWidth=this.lineWidth,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(this.x,this.y,a+1,0,2*Math.PI),this.ctx.strokeStyle="black",this.ctx.lineWidth=this.lineWidth,this.ctx.stroke()},e.prototype.getTopLeft=function(){return{left:this.x-this.width/2,top:this.y-this.height/2}}}();